!function(){window.App={Models:{},Views:{},Collections:{},JST:{}},window.vent=_.extend({},Backbone.Events),window.template=function(a){return _.template($("#"+a).html())},Backbone.View.prototype.close=function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}}(),this.window=this.window||{},this.window.App=this.window.App||{},this.window.App.JST=this.window.App.JST||{},this.window.App.JST.api=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<article>\n\n	<p>Апи находится по адресу <a href="http://wordoftheday.herokuapp.com/api"></a></p>\n\n	<h2>Доступные команды</h2>\n\n	<h3>Аутентификация</h3>\n\n	<dl>\n		<dt>POST <strong>/api</strong></dt>\n			<dd>Тестовая аутефикация по токену. Принимает пост запрос с параметром auth. Тестовый запрос будет ввиде auth=hashed_password.</dd>\n		<dt>GET <strong>/api</strong></dt>\n			<dd>Список апи</dd>\n	</dl>\n\n	<h3>Слова</h3>\n\n	<dl>\n		<dt>GET <strong>/api/words</strong></dt>\n			<dd>Получить все слова. Возвращает json {answer, category_id, id, word}</dd>\n\n		<dt>GET <strong>/api/words/{:word}</strong></dt>\n			<dd>Слово по id. Возвращает json {answer, category_id, id, word}</dd>\n\n		<dt>POST <strong>/api/words</strong></dt>\n			<dd>Создать новое слово. Принимает word=string, answer=string, test_id=integer</dd>\n\n		<dt>DELETE <strong>/api/words/{:word}</strong></dt>\n			<dd>Удалить слово по id</dd>\n	</dl>\n\n	<h3>Пользователи</h3>\n\n	<dl>\n		<dt>GET <strong>/api/users</strong></dt>\n			<dd>Получить всех пользователей</dd>\n\n		<dt>GET <strong>/api/users/{:user_id}</strong></dt>\n			<dd>Получить пользователя по id</dd>\n\n		<dt>PUT <strong>/api/users/{:user_id}</strong></dt>\n			<dd>Отредактировать пользователя по id. Принимает username=string, password=string, balance=integer</dd>\n\n		<dt>DELETE <strong>/api/users/{:user_id}</strong></dt>\n			<dd>Удалить пользователя по id</dd>\n\n		<dt>GET <strong>/api/user/{:user_id}/words</strong></dt>\n			<dd>Показать все слова добавленные пользователем на модерацию</dd>\n\n		<dt>POST <strong>/api/user/{:user_id}/addword</strong></dt>\n			<dd>Добавить слово на модерацию. Принимает word=string, answer=string</dd>\n\n		<dt>POST <strong>/api/user/{:word}/removeword</strong></dt>\n			<dd>Удалить слово из слов пользователя.</dd>\n	</dl>\n\n	<h3>Слова на модерацию</h3>\n\n	<dl>\n		<dt>GET <strong>/api/moderate/words</strong></dt>\n			<dd>Получить все слова на модерацию</dd>\n\n		<dt>GET <strong>/api/moderate/words/{:word}</strong></dt>\n			<dd>Получить слово по id</dd>\n\n		<dt>DELETE <strong>/api/moderate/word{:word}</strong></dt>\n			<dd>Пометить слово как "отвергнутое". Изменяет статус слова на rejected</dd>\n\n		<dt>POST <strong>/api/moderate/words/{:word}/changestatus</strong></dt>\n			<dd>Изменить статус слова. Принимает status=accepted/rejected/waiting</dd>\n			<dd>При указании статуса как accepted создает копию в базу слов</dd>\n	</dl>\n\n	<h3>Подписки</h3>\n	Аутентификация auth=hashed_password\n\n	<dl>\n		<dt>POST <strong>/api/user/{:user_id}/subscribe</strong></dt>\n			<dd>Подписать пользователя на категорию. Принимает category_id=integer</dd>\n\n		<dt>GET <strong>/api/user/{:user_id}/subscriptions</strong></dt>\n			<dd>Получить список подписанных категорий</dd>\n\n		<dt>POST <strong>/api/user/{:user_id}/unsubscribe</strong></dt>\n			<dd>Отписать пользователя от категории category_id=integer</dd>\n	</dl>\n\n	<h3>Устройства</h3>\n	На данный момент каждый пользователь привязывается к одному устройству.\n\n	<dl>\n		<dt>GET <strong>/api/user/{:user_id}/devices</strong></dt>\n			<dd>Получить все устройства пользователя</dd>\n\n		<dt>POST <strong>/api/user/{:user_id}/add_device</strong></dt>\n			<dd>Добавить устройство к пользователю. Принимает device_id</dd>\n\n		<dt>POST <strong>/api/user/{:user_id}/remove_device</strong></dt>\n			<dd>Удалить устройство у пользователя. Принимает device_id=integer</dd>\n	</dl>\n\n	<h3>Категории</h3>\n\n	<dl>\n		<dt>GET <strong>/api/categories</strong></dt>\n			<dd>Возвращает все категории [{id, name, subscription_price, test_price, words}, {...}]</dd>\n\n		<dt>GET <strong>/api/categories/{:category}</strong></dt>\n			<dd>Возвращает категорию по id, в формате {id, name, subscription_price, test_price, words}</dd>\n\n		<dt>DELETE <strong>/api/category/{:category}</strong></dt>\n			<dd>Удаляет категорию по id</dd>\n	</dl>\n\n	<h3>Тест</h3>\n\n	<dl>\n		<dt>POST <strong>/api/test/start</strong></dt>\n			<dd>Начать тест, принимает category=id user=id.</dd>\n			<dd>Возвращает, balance, cards{answer, category_id, id, word}</dd>\n\n		<dt>POST <strong>/api/user/{user_id}/addlife</strong></dt>\n			<dd>Принимает user=id</dd>\n			<dd>Возвращает пользователя {balance, id, max_result, overal_standing, username}</dd>\n\n		<dt>GET <strong>/api/randomwords</strong></dt>\n			<dd>Получить рандомно 20 слов из каждой категории</dd>\n			<dd>Считает максимально возможное количество слов на категорию и рандомно берет слова из неё. По возрастанию, пока не наберет максимальное количество</dd>\n	</dl>\n\n	<h3>Настройки</h3>\n\n	<dl>\n		<dt>GET <strong>/api/settings</strong></dt>\n			<dd>Получить настройки. Возвращает json {answer_time, daily_bonus, general_cost, test_cost, top_bonus, word_cost}</dd>\n\n		<dt>POST <strong>/api/settings</strong></dt>\n			<dd>Редактировать настройки. Отправить новые настройки. Принимает answer_time=integer, daily_bonus=interger, general_cost=integer, top_bonus=integer, word_cost=integer</dd>\n	</dl>\n\n</article>';return __p},this.window.App.JST.auth=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<div class="header"><h1>Панель управления</h1></div>\n	<div class="content">\n	<form id="auth" class="pure-form">\n		<div>\n			<label for="user">Пользователь</label>\n			<input type="text" id="user" autofocus>\n		</div>\n\n		<div>\n			<label for="password">Пароль</label>\n			<input type="password" id="password">\n		</div>\n\n		<div>\n			<span="#" id="log-in" class="pure-button pure-button-primary">Войти</span>\n		</div>\n</form></div>';return __p},this.window.App.JST["card/add"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<form class="pure-form" id="addWord">\n\n	<div>\n		<label for="word">Слово</label>\n		 <input type="text" id="word" name="word">\n	</div>\n\n	<div>\n		<label for="answer">Ответ</label>\n		<textarea type="answer" id="answer" name="answer"></textarea>\n	</div>\n	\n	<div>\n		<label id="cat_id_label" for="test_id">Категория</label>\n	</div>\n	\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Добавить">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n\n</form>';return __p},this.window.App.JST["card/all"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+="<td>"+(null==(__t=word)?"":__t)+'</td>\n<td><a href="/words/'+(null==(__t=id)?"":__t)+'/edit" class="edit"><img src="/img/edit.png"></a></td>\n<td><a href="/words/'+(null==(__t=id)?"":__t)+'" class="delete"><img src="/img/delete.png"></a></td>';return __p},this.window.App.JST["card/edit"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<form id="editWordForm">\n	<div>\n		<label for="word">Слово</label>\n		<input type="text" id="edit_word" name="word" value="'+(null==(__t=word)?"":__t)+'">\n	</div>\n	\n	<div>\n		<label for="answer">Ответ</label>\n		<textarea type="answer" id="edit_answer" name="answer">'+(null==(__t=answer)?"":__t)+'</textarea>\n	</div>\n\n	<div>\n		<label id="cat_id_label" for="category_id">Категория</label>\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Редактировать">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n</form>\'';return __p},this.window.App.JST["card/layout"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<h2 class="content-header"><a href="categories" class="back"><img src="/img/left.png"></a>Карточки слов<a href="category/'+(null==(__t=category_id)?"":__t)+'/word/add"><img src="/img/add.png"></a></h2>\n\n<table>\n	<thead>\n		<tr>\n			<td>слово</td>\n			<td colspan="2" class="options">Опции</td>\n		</tr>\n	</thead>\n</table>';return __p},this.window.App.JST["card/single"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<td class="id">'+(null==(__t=id)?"":__t)+"</td>\n<td>"+(null==(__t=name)?"":__t)+"</td>\n<td>"+(null==(__t=words)?"":__t)+'</td>\n<td class="edit-c"><a href="/category/'+(null==(__t=id)?"":__t)+'/edit" class="edit"><img src="/img/edit.png"></a></td>\n<td class="delete-c"><a href="/category/'+(null==(__t=id)?"":__t)+'" class="delete"><img src="/img/delete.png"></a></td>\n<td class="words-c"><a href="/category/'+(null==(__t=id)?"":__t)+'/words" class="words"><img src="/img/right.png"></a></td>';return __p},this.window.App.JST["category/add"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<form class="pure-form" id="addCategory">\n	<div>\n		<label for="name">Название</label>\n		<input type="text" id="name" name="name">\n	</div>\n\n	<div>\n		<label for="subscription_price">Цена подписки</label>\n		<input type="text" id="subscription_price" name="subscription_price">\n	</div>\n\n	<div>\n		<label for="test_price">Цена теста</label>\n		<input type="text" id="test_price" name="test_price">\n	</div>\n\n	<div>\n		<label for="ua_parameter">UA Parameter</label>\n		<input type="text" id="ua_parameter" name="ua_parameter">\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Добавить">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n</form>';return __p},this.window.App.JST["category/all"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="";return __p},this.window.App.JST["category/edit"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<form id="editCategory">\n	<div>\n		<label for="edit_name">Название</label>\n		<input type="text" id="edit_name" name="name" value="'+(null==(__t=name)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="subscription_price">Цена подписки</label>\n		<input type="text" id="edit_subscription_price" name="subscription_price" value="'+(null==(__t=subscription_price)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="testa_price">Цена теста</label>\n		<input type="text" id="edit_test_price" name="test_price" value="'+(null==(__t=test_price)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="ua_parameter">UA Parameter</label>\n		<input type="text" id="edit_ua_parameter" name="ua_parameter" value="'+(null==(__t=ua_parameter)?"":__t)+'">\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Редактировать">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n</form>';return __p},this.window.App.JST["category/layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<h2 class="content-header">Категории<a href="/category/add"><img src="img/add.png"></a></h2>\n\n<table>\n	<thead>\n		<tr>\n			<td>ID</td>\n			<td>Название</td>\n			<td>Слов</td>\n			<td>UA Parameter</td>\n			<td colspan="3" class="options">Опции</td>\n		</tr>\n	</thead>\n</table>';return __p},this.window.App.JST["category/single"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<td class="id">'+(null==(__t=id)?"":__t)+"</td>\n<td>"+(null==(__t=name)?"":__t)+"</td>\n<td>"+(null==(__t=words)?"":__t)+"</td>\n<td>"+(null==(__t=ua_parameter)?"":__t)+'</td>\n<td class="edit-c"><a href="/category/'+(null==(__t=id)?"":__t)+'/edit" class="edit"><img src="/img/edit.png"></a></td>\n<td class="delete-c"><a href="/category/'+(null==(__t=id)?"":__t)+'" class="delete"><img src="/img/delete.png"></a></td>\n<td class="words-c"><a href="/category/'+(null==(__t=id)?"":__t)+'/words" class="words"><img src="/img/right.png"></a></td>';return __p},this.window.App.JST.layout=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<a href="#" id="menuLink" class="menu-link">\n	<span></span>\n</a>\n\n<div id="menu">\n	<div class="pure-menu pure-menu-open">\n		<a class="pure-menu-heading" href="/">WOTD</a>\n		\n		<ul>\n			<li><a href="/users">Пользователи</a></li>\n			<li><a href="/categories">Категории</a></li>\n			<li><a href="/moderation">Модерация</a></li>\n			<li><a href="/settings">Настройки</a></li>\n			<li><a href="/api/usage">Функции апи</a></li>\n			<li><a href="/logout">Выход</a></li>\n		</ul>\n	</div>\n</div>\n\n<div id="main">\n	<div class="header">\n		<h1>Панель управления</h1>\n		<h2>Слово дня</h2>\n	</div>\n\n	<div class="content">\n\n	</div>\n\n</div>';return __p},this.window.App.JST["moderation/layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<h2 class="content-header">Слова на модерацию</a></h2>\n\n<table>\n	<thead>\n		<tr>\n			<td>ID</td>\n			<td>Слово</td>\n			<td>Ответ</td>\n			<td>Поместить в</td>\n			<td colspan="2" class="options">Опции</td>\n		</tr>\n	</thead>\n</table>';return __p},this.window.App.JST["moderation/single"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<td class="id">'+(null==(__t=id)?"":__t)+"</td>\n<td>"+(null==(__t=word)?"":__t)+"</td>\n<td>"+(null==(__t=answer)?"":__t)+'</td>\n<td class="categories-dropdown">In: Category</td>\n<td class="edit"><a href="/api/moderate/'+(null==(__t=id)?"":__t)+'/accept" class="accept"><img src="/img/ok.png"></a></td>\n<td class="delete"><a href="/api/moderate/'+(null==(__t=id)?"":__t)+'/decline" class="reject"><img src="/img/delete.png"></a></td>la';return __p},this.window.App.JST.settings=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<form class="pure-form" id="settings">\n	<div>\n		<label for="answer_time">Время ответа</label>\n	 	<input type="number" id="answer_time" name="answer_time" value="'+(null==(__t=answer_time)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="daily_bonus">Ежедневный бонус</label>\n		 <input type="number" id="daily_bonus" name="daily_bonus" value="'+(null==(__t=daily_bonus)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="general_cost">Базовая стоимость</label>\n		 <input type="number" id="general_cost" name="general_cost" value="'+(null==(__t=general_cost)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="life_cost">Стоимость жизни</label>\n		 <input type="number" id="life_cost" name="life_cost" value="'+(null==(__t=life_cost)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="top_bonus">Максимальный бонус</label>\n		 <input type="number" id="top_bonus" name="top_bonus" value="'+(null==(__t=top_bonus)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="word_cost">Слово</label>\n		<input type="number" id="word_cost" name="word_cost" value="'+(null==(__t=word_cost)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="words_for_the_next_bonus">Количество слов за следующий бонус</label>\n		<input type="number" id="words_for_the_next_bonus" name="words_for_the_next_bonus" value="'+(null==(__t=words_for_the_next_bonus)?"":__t)+'">\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Сохранить">\n	</div>\n\n</form>';return __p},this.window.App.JST["user/add"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<form class="pure-form" id="addWord">\n	\n	<div>\n		<label for="username">Имя пользователя</label>\n		<input type="text" id="username" name="username">\n	</div>\n\n	<div>\n		<label for="password">Пароль</label>\n		<input type="text" id="password" name="password">\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Добавить">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n\n</form>';return __p},this.window.App.JST["user/edit"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<form id="editUser" class="pure-form" id="addWord">\n	\n	<div>\n		<label for="edit_username">Имя пользователя</label>\n		<input type="text" id="edit_username" name="edit_username" value="'+(null==(__t=username)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="edit_password">Пароль</label>\n		<input type="password" id="edit_password" name="edit_password" >\n	</div>\n\n	<div>\n		<label for="edit_balance">Монет</label>\n		<input type="text" id="edit_balance" name="edit_balance" value="'+(null==(__t=balance)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="edit_max_result">Максимальный результат</label>\n		<input type="text" id="edit_max_result" name="edit_max_result" value="'+(null==(__t=max_result)?"":__t)+'">\n	</div>\n\n	<div>\n		<label for="edit_overal_standing">Общий зачет</label>\n		<input type="text" id="edit_overal_standing" name="edit_overal_standing" value="'+(null==(__t=overal_standing)?"":__t)+'">\n	</div>\n\n	<div>\n		<input type="submit" class="pure-button pure-button-primary" value="Редактировать">\n		<span class="pure-button close">Закрыть</span>\n	</div>\n\n</form>';return __p},this.window.App.JST["user/layout"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<h2 class="content-header">Пользователи<a href="/user/add"><img src="img/add.png"></a></h2>\n\n<table>\n	<thead>\n		<tr>\n			<td>Имя</td>\n			<td>Монеты</td>\n			<td>Макс Результат</td>\n			<td>Общий зачет</td>\n			<td colspan="2" class="options">Опции</td>\n		</tr>\n	</thead>\n</table>';return __p},this.window.App.JST["user/list"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+=(null==(__t=username)?"":__t)+", монет: "+(null==(__t=balance)?"":__t)+'\n<a href="/user/'+(null==(__t=id)?"":__t)+'/edit" class="edit">Редактировать</a>\n<a href="/user/'+(null==(__t=id)?"":__t)+'" class="delete">X</a>';return __p},this.window.App.JST["user/single"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+="<td>"+(null==(__t=username)?"":__t)+"</td>\n<td>"+(null==(__t=balance)?"":__t)+"</td>\n<td>"+(null==(__t=max_result)?"":__t)+"</td>\n<td>"+(null==(__t=overal_standing)?"":__t)+'</td>\n<td><a href="/user/'+(null==(__t=id)?"":__t)+'/edit" class="edit"><img src="/img/edit.png"></a></td>\n<td><a href="/user/'+(null==(__t=id)?"":__t)+'" class="delete"><img src="/img/delete.png"></a></td>\n';return __p},App.Models.Card=Backbone.Model.extend({}),App.Models.Category=Backbone.Model.extend({}),App.Models.ModeratedCart=Backbone.Model.extend({}),App.Models.Session=Backbone.Model.extend({defaults:{access_token:null,user_id:null},initialize:function(){this.load()},authenticated:function(){return Boolean(this.get("access_token"))},save:function(a){this.set("user_id",a.id),this.set("access_token",a.access_token)},load:function(){this.set("user_id",$.cookie("user_id")),this.set("access_token",$.cookie("access_token"))},unload:function(){this.set("user_id",""),this.set("access_token","")}}),App.Models.Settings=Backbone.Model.extend({}),App.Models.Test=Backbone.Model.extend({}),App.Models.User=Backbone.Model.extend({}),App.Collections.Cards=Backbone.Collection.extend({model:App.Models.Card,url:"/api/words"}),App.Collections.Categories=Backbone.Collection.extend({model:App.Models.Category,url:"/api/categories"}),App.Collections.ModeratedCarts=Backbone.Collection.extend({model:App.Models.ModeratedCart,url:"/api/moderate/words"}),App.Collections.Settings=Backbone.Collection.extend({model:App.Models.Settings,url:"api/settings"}),App.Collections.Tests=Backbone.Collection.extend({model:App.Models.Test,url:"/api/tests"}),App.Collections.Users=Backbone.Collection.extend({model:App.Models.User,url:"/api/users"}),App.Views.CategoryCardsApp=Backbone.View.extend({initialize:function(a){this.options=a||{},vent.on("card:edit",this.editCard,this),$(".content").empty().append(window.App.JST["card/layout"]);var b=new App.Views.Cards({collection:App.Cards,category_id:this.options.category_id}).render();b.$el.insertAfter(".content thead")},editCard:function(a){var b=new App.Views.EditCard({model:a});b.$el.insertAfter(".content-header");var c=new App.Views.CategoriesDropdown({collection:App.categories}).render();c.$el.insertAfter($("#cat_id_label"))},onClose:function(){vent.off("card:edit",this.editCard,this)}}),App.Views.CardsApp=Backbone.View.extend({initialize:function(a){this.options=a||{},vent.on("card:edit",this.editCard,this);var b=new App.Views.Cards({collection:App.cards}).render();$(".content").empty().append(window.App.JST["card/layout"](this.options)),b.$el.insertAfter(".content thead")},editCard:function(a){var b=new App.Views.EditCard({model:a});b.$el.insertAfter(".content-header");var c=new App.Views.CategoriesDropdown({collection:App.categories}).render();c.$el.insertAfter($("#cat_id_label")),$("#category_id").val(a.get("category_id"))},onClose:function(){vent.off("card:edit",this.editCard,this)}}),App.Views.Cards=Backbone.View.extend({tagName:"tbody",initialize:function(){this.collection.on("add",this.addOne,this),this.collection.comparator=function(){return-1}},render:function(){return this.collection.each(this.addOne,this),this},addOne:function(a){var b=new App.Views.Card({model:a});this.$el.prepend(b.render().el)}}),App.Views.Card=Backbone.View.extend({tagName:"tr",template:window.App.JST["card/all"],initialize:function(){this.model.on("destroy",this.unrender,this),this.model.on("change",this.render,this)},events:{"click a.delete":"deleteCard","click a.edit":"editCard"},editCard:function(){vent.trigger("card:edit",this.model)},deleteCard:function(){this.model.destroy()},unrender:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),App.Views.AddCard=Backbone.View.extend({initialize:function(a){this.options=a,this.render(),this.$el.insertAfter(".content-header");var b=new App.Views.CategoriesDropdown({collection:App.categories}).render();b.$el.insertAfter($("#cat_id_label")),$("#category_id").val(this.options.category_id),this.word=$("#word"),this.answer=$("#answer"),this.category_id=$("#category_id")},events:{submit:"submit","click .close":"cancel"},submit:function(a){a.preventDefault(),this.collection.create({word:this.word.val(),answer:this.answer.val(),category_id:this.category_id.val()},{wait:!0}),this.clearForm()},render:function(){var a=window.App.JST["card/add"];return this.$el.html(a),this},cancel:function(a){a.preventDefault(a),this.remove(),history.back()},clearForm:function(){this.word.val(""),this.answer.val("")}}),App.Views.EditCard=Backbone.View.extend({template:window.App.JST["card/edit"],initialize:function(){this.render(),this.model.on("destroy",this.unrender,this)},events:{"submit form":"submit","click .close":"cancel"},submit:function(a){a.preventDefault(),this.model.save({word:$("#edit_word").val(),answer:$("#edit_answer").val(),category_id:$("#category_id").val()},{wait:!0}),this.unbind(),this.remove()},cancel:function(){this.unbind(),this.remove()},unrender:function(){this.remove()},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}}),App.Views.CategoriesApp=Backbone.View.extend({initialize:function(){vent.on("category:edit",this.editCategory,this);var a=new App.Views.Categories({collection:App.categories}).render();$(".content").empty().append(window.App.JST["category/layout"]),a.$el.insertAfter(".content thead")},editCategory:function(a){var b=new App.Views.EditCategory({model:a});b.$el.insertAfter(".content-header")},onClose:function(){vent.off("category:edit",this.editCard,this)}}),App.Views.Categories=Backbone.View.extend({tagName:"tbody",initialize:function(){this.collection.on("add",this.addOne,this),this.collection.comparator=function(){return-1}},render:function(){return this.collection.each(this.addOne,this),this},addOne:function(a){var b=new App.Views.Category({model:a});this.$el.prepend(b.render().el)},remove:function(){this.remove(),this.unbind()}}),App.Views.CategoriesDropdown=Backbone.View.extend({template:_.template(["<select id='category_id'>","<% categories.each(function(category) { %>","<%= categoryTemplate(category) %>","<% }); %>","</select>"].join("")),categoryTemplate:function(a){return 211==a.get("id")?"<option selected value="+a.get("id")+">"+a.get("name")+"</option>":"<option value="+a.get("id")+">"+a.get("name")+"</option>"},initialize:function(){this.collection.on("add",this.addOne,this),this.collection.comparator=function(){return-1}},render:function(){var a=this.template({categories:this.collection,categoryTemplate:this.categoryTemplate});return this.$el.append(a),this}}),App.Views.Category=Backbone.View.extend({tagName:"tr",template:window.App.JST["category/single"],initialize:function(){this.model.on("destroy",this.unrender,this),this.model.on("change",this.render,this)},events:{"click a.delete":"deleteCategory","click a.edit":"editCategory"},editCategory:function(){vent.trigger("category:edit",this.model)},deleteCategory:function(){ok=confirm("Вы действительно хотите удалить выбранную категорию?"),1==ok&&this.model.destroy()},unrender:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),App.Views.AddCategory=Backbone.View.extend({initialize:function(){this.render(),this.$el.insertAfter(".content-header"),this.name=$("#name"),this.subscription_price=$("#subscription_price"),this.test_price=$("#test_price"),this.ua_parameter=$("#ua_parameter")},events:{submit:"addCategory","click .close":"close"},addCategory:function(a){a.preventDefault(a),this.collection.create({name:this.name.val(),subscription_price:this.subscription_price.val(),test_price:this.test_price.val(),ua_parameter:this.ua_parameter.val()},{wait:!0}),this.clearForm()},render:function(){var a=window.App.JST["category/add"];return this.$el.html(a),this},close:function(a){a.preventDefault(a),this.remove()},clearForm:function(){this.name.val(""),this.subscription_price.val(""),this.test_price.val(""),this.ua_parameter.val("")}}),App.Views.EditCategory=Backbone.View.extend({template:window.App.JST["category/edit"],initialize:function(){this.render(),this.form=this.$("#editCategory"),this.name=this.form.find("#edit_name"),this.subscription_price=this.form.find("#edit_subscription_price"),this.test_price=this.form.find("#edit_test_price"),this.ua_parameter=this.form.find("#edit_ua_parameter")},events:{"submit form":"submit","click .close":"cancel"},submit:function(a){a.preventDefault(),this.model.save({name:this.name.val(),subscription_price:this.subscription_price.val(),test_price:this.test_price.val(),ua_parameter:this.ua_parameter.val()},{wait:!0}),this.remove()},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},cancel:function(a){a.preventDefault(),this.remove()}}),App.Views.ModerationApp=Backbone.View.extend({initialize:function(){var a=new App.Views.ModerationWords({collection:App.moderation}).render();$(".content").empty().append(window.App.JST["moderation/layout"]),a.$el.insertAfter(".content thead")}}),App.Views.ModerationWords=Backbone.View.extend({tagName:"tbody",initialize:function(){this.collection.on("add",this.addOne,this),this.collection.comparator=function(){return-1}},render:function(){return this.collection.each(this.addOne,this),this},addOne:function(a){var b=new App.Views.ModerationWord({model:a});this.$el.prepend(b.render().el)},remove:function(){this.remove()}}),App.Views.ModerationWord=Backbone.View.extend({tagName:"tr",template:window.App.JST["moderation/single"],initialize:function(){this.model.on("destroy",this.unrender,this),this.model.on("change",this.unrender,this)},events:{"click .accept":"accept","click .reject":"reject"},accept:function(a){id=this.model.get("id"),category=$(a.target).parent().parent().find("#category_id").val(),that=this,$.ajax({type:"POST",url:"/api/moderate/words/"+id+"/changestatus",data:{category:category,status:"accepted"}}).done(function(){that.model.fetch()}).fail(function(){})},reject:function(){this.model.destroy()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},unrender:function(){this.remove()}}),App.Views.SettingsApp=Backbone.View.extend({initialize:function(){var a=new App.Views.Settings({model:this.collection.models[0]}).render();$(".content").empty().append("<h2>Настройки</h2>").append(a.el)}}),App.Views.Settings=Backbone.View.extend({template:window.App.JST.settings,render:function(){return this.$el.html(this.template(this.model.toJSON())),this},events:{submit:"submit","click .close":"cancel"},submit:function(a){a.preventDefault(),this.model.save({answer_time:$("#answer_time").val(),daily_bonus:$("#daily_bonus").val(),general_cost:$("#general_cost").val(),life_cost:$("#life_cost").val(),top_bonus:$("#top_bonus").val(),word_cost:$("#word_cost").val(),words_for_the_next_bonus:$("#words_for_the_next_bonus").val()},{wait:!0}),$("<span> Сохранено</span>").insertAfter(".pure-button")}}),App.Views.UsersApp=Backbone.View.extend({initialize:function(){vent.on("user:edit",this.editUser,this);var a=new App.Views.Users({collection:App.users}).render();$(".content").empty().append(window.App.JST["user/layout"]),a.$el.insertAfter(".content thead")},editUser:function(a){var b=new App.Views.EditUser({model:a});b.$el.insertAfter(".content-header")},onClose:function(){vent.off("user:edit",this.editUser,this)}}),App.Views.Users=Backbone.View.extend({tagName:"tbody",initialize:function(){this.collection.on("add",this.addOne,this)},render:function(){return this.collection.each(this.addOne,this),this},addOne:function(a){var b=new App.Views.User({model:a});this.$el.append(b.render().el)}}),App.Views.User=Backbone.View.extend({tagName:"tr",template:window.App.JST["user/single"],initialize:function(){this.model.on("destroy",this.unrender,this),this.model.on("change",this.render,this)},events:{"click a.delete":"deleteUser","click a.edit":"editUser"},editUser:function(){vent.trigger("user:edit",this.model)},deleteUser:function(){this.model.destroy()},unrender:function(){this.remove()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),App.Views.AddUser=Backbone.View.extend({initialize:function(){this.render(),this.$el.insertAfter(".content-header"),this.username=$("#username"),this.password=$("#password")},events:{submit:"addUser","click .close":"close"},addUser:function(a){a.preventDefault(a),this.collection.create({username:this.username.val(),password:this.password.val()},{wait:!0}),this.clearForm()},render:function(){var a=window.App.JST["user/add"];return this.$el.html(a),this},close:function(a){a.preventDefault(),this.remove()},clearForm:function(){this.username.val(""),this.password.val("")}}),App.Views.EditUser=Backbone.View.extend({template:window.App.JST["user/edit"],initialize:function(){this.render(),this.form=this.$("#editUser"),this.username=this.form.find("#edit_username"),this.password=this.form.find("#edit_password"),this.balance=this.form.find("#edit_balance"),this.max_result=this.form.find("#edit_max_result"),this.overal_standing=this.form.find("#edit_overal_standing")},events:{"submit form":"submit","click .close":"cancel"},submit:function(a){a.preventDefault(),this.model.save({username:this.username.val(),password:this.password.val(),balance:this.balance.val(),max_result:this.max_result.val(),overal_standing:this.overal_standing.val()},{wait:!0}),this.remove()},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},cancel:function(a){a.preventDefault(),this.remove()}}),App.Router=Backbone.Router.extend({initialize:function(){App.session=new App.Models.Session},routes:{"":"categories","api/usage":"index",users:"users","user/add":"addUser",categories:"categories","category/add":"addCategory","category/:category_id/word/add":"addCategoryWord","category/:category_id/words":"categoryWords",moderation:"moderation",login:"login",logout:"logout",settings:"settings"},settings:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),App.settings=new App.Collections.Settings,App.settings.fetch().then(function(){App.current=new App.Views.SettingsApp({collection:App.settings})})):this.navigate("/login",{trigger:!0})},index:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),$(".content").append("<h2>Функции апи</h2>"),$(".content").append(window.App.JST.api)):this.navigate("/login",{trigger:!0})
},login:function(){function a(a){if(a.preventDefault(a),App.session.authenticated())b.navigate("/categories",{trigger:!0});else{var c={user:$("#user").val(),password:$("#password").val()};$.post("/api/users/adminauth",c).success(function(){App.session.save({user_id:$("#user").val(),access_token:$("#password").val()}),b.navigate("/categories",{trigger:!0})}).fail(function(a){$("#error-message").remove(),$("#log-in").parent().append('<span id="error-message"> '+a.responseJSON.error.message+"</span>")})}}$("#layout").empty().append(window.App.JST.auth);var b=this;$("#log-in").click(a),$(document).keypress(function(b){13==b.which&&a(b)})},logout:function(){$(".content").empty(),App.session.unload(),this.navigate("/login",{trigger:!0})},moderation:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),App.moderation=new App.Collections.ModeratedCarts,App.categories=new App.Collections.Categories,App.moderation.fetch().then(function(){App.current=new App.Views.ModerationApp({collection:App.moderation}),App.categories.fetch().then(function(){AllCategoriesViewDropdown=new App.Views.CategoriesDropdown({collection:App.categories}).render(),$(".categories-dropdown").html(AllCategoriesViewDropdown.el)})})):this.navigate("/login",{trigger:!0})},users:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),App.users=new App.Collections.Users,App.users.fetch().then(function(){App.current=new App.Views.UsersApp({collection:App.users})})):this.navigate("/login",{trigger:!0})},words:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),$(".content").append('<h2 class="content-header">Карточки слов<a href="/word/add">+</a></h2>'),App.cards=new App.Collections.Cards,App.categories=new App.Collections.Categories,App.cards.fetch().then(function(){App.current=new App.Views.CardsApp({collection:App.cards}),App.categories.fetch().then(function(){new App.Views.CategoriesDropdown({collection:App.cards})})})):this.navigate("/login",{trigger:!0})},addCategoryWord:function(a){var b=new App.Views.AddCard({collection:App.cards,category_id:a});b.$el.insertAfter(".content-header")},addWord:function(){},addUser:function(){var a=new App.Views.AddUser({collection:App.users});a.$el.insertAfter(".content-header")},categories:function(){$("#layout").empty(),App.current&&App.current.close&&App.current.close(),App.session.authenticated()?($("#layout").append(window.App.JST.layout),App.categories=new App.Collections.Categories,App.categories.fetch().then(function(){App.current=new App.Views.CategoriesApp({collection:App.categories})})):this.navigate("/login",{trigger:!0})},addCategory:function(){var a=new App.Views.AddCategory({collection:App.categories});a.$el.insertAfter(".content-header")},categoryWords:function(a){App.current&&App.current.close&&App.current.close(),App.session.authenticated()?(App.Collections.CategoryCards=Backbone.Collection.extend({model:App.Models.Card,url:"/api/categories/"+a+"/words"}),App.categoryCards=new App.Collections.CategoryCards,$(".content").empty(),App.categoryCards.fetch().then(function(){App.cards=new App.Collections.Cards,App.cards.reset(App.categoryCards.toJSON()),App.current=new App.Views.CardsApp({collection:App.cards,category_id:a})})):this.navigate("/login",{trigger:!0})}});